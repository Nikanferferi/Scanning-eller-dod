<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#a3dfff" />
  <link rel="manifest" href="manifest.json" />
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <title>Sanning eller D√∂d</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(to bottom, #a3dfff, #d4f1ff);
      color: #111;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    .hidden { display: none; }
    .button {
      background-color: #007BFF;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 10px;
      border-radius: 10px;
      font-size: 16px;
    }
    input {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    #answerList li {
      text-align: left;
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <div id="startScreen">
    <h1>Sanning eller D√∂d</h1>
    <p>Skriv ditt namn:</p>
    <input type="text" id="username" placeholder="Ditt namn" /><br><br>
    <p>Hur m√•nga fr√•gor vill du ha? (1‚Äì200)</p>
    <input type="number" id="questionCountInput" min="1" max="200" placeholder="Antal fr√•gor" /><br><br>
    <button class="button" onclick="startGame()">Starta spelet</button>
  </div>

  <div id="gameScreen" class="hidden">
    <h2 id="greeting"></h2>
    <div id="questionSection">
      <button class="button" onclick="choose('sanning')">Sanning</button>
      <button class="button" onclick="choose('d√∂d')">D√∂d</button>
    </div>
    <h3 id="question" class="hidden"></h3>
    <div id="answerSection" class="hidden">
      <input type="text" id="answerInput" placeholder="Ditt svar h√§r..." />
      <button class="button" onclick="submitAnswer()">Skicka svar</button>
    </div>
    <div id="nextSection" class="hidden">
      <button class="button" onclick="resetGame()">N√§sta fr√•ga</button>
    </div>
    <ul id="answerList"></ul>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <script>
    // Firebase-konfiguration
    const firebaseConfig = {
      apiKey: "AIzaSyA15cB5GxEtNvywnUnwTqt9_VU8pflZ6cU",
      authDomain: "sanning-eller-dod.firebaseapp.com",
      projectId: "sanning-eller-dod",
      storageBucket: "sanning-eller-dod.firebasestorage.app",
      messagingSenderId: "997234297530",
      appId: "1:997234297530:web:32f63a33891563cbb91083",
      measurementId: "G-MFZ8REC8B9"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const sanningFr√•gor = [
      "Har du n√•gonsin ljugit f√∂r din b√§sta v√§n?",
      "Vad √§r det pinsammaste du gjort i skolan?",
      "Vem √§r din hemliga crush?",
      "Vad skulle du g√∂ra med en miljon kronor?",
      "Har du fuskat p√• ett prov?"
    ];

    const d√∂dUtmaningar = [
      "G√∂r 10 armh√§vningar!",
      "Ring n√•gon och sjung 'B√§ b√§ vita lamm'",
      "Hoppa p√• ett ben i 30 sekunder!",
      "S√§g ett konstigt ljud i 15 sekunder!",
      "G√∂r en TikTok-dans nu (p√• l√•tsas)"
    ];

    let playerName = "";
    let currentQuestion = "";
    let questionCount = 0;
    let maxQuestions = 5;
    let blandadeSanning = [];
    let blandadeD√∂d = [];

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function startGame() {
      const name = document.getElementById("username").value.trim();
      const count = parseInt(document.getElementById("questionCountInput").value, 10);
      if (!name || isNaN(count) || count < 1 || count > 200) {
        return alert("Ange ett giltigt namn och antal fr√•gor (1‚Äì200)");
      }

      playerName = name;
      maxQuestions = count;
      questionCount = 0;

      blandadeSanning = [...sanningFr√•gor];
      blandadeD√∂d = [...d√∂dUtmaningar];
      shuffle(blandadeSanning);
      shuffle(blandadeD√∂d);

      document.getElementById("startScreen").classList.add("hidden");
      document.getElementById("gameScreen").classList.remove("hidden");
      document.getElementById("greeting").textContent = `Hej ${playerName}! Fr√•ga 1 av ${maxQuestions}`;
    }

    function choose(type) {
      document.body.style.background = type === "sanning" ? "#ffffff" : "#000000";
      document.body.style.color = type === "sanning" ? "#111" : "#fff";

      let fr√•ga = "";
      if (type === "sanning" && blandadeSanning.length > 0) {
        fr√•ga = blandadeSanning.shift();
      } else if (type === "d√∂d" && blandadeD√∂d.length > 0) {
        fr√•ga = blandadeD√∂d.shift();
      } else {
        fr√•ga = "Inga fler fr√•gor!";
      }

      currentQuestion = fr√•ga;
      document.getElementById("question").textContent = currentQuestion;
      document.getElementById("question").classList.remove("hidden");
      document.getElementById("answerSection").classList.remove("hidden");
      document.getElementById("questionSection").classList.add("hidden");
    }

    function submitAnswer() {
      const answer = document.getElementById("answerInput").value.trim();
      if (!answer) return alert("Skriv ett svar!");

      confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });

      const response = `üé§ ${playerName} (${currentQuestion}): ${answer}`;
      const li = document.createElement("li");
      li.textContent = response;
      document.getElementById("answerList").appendChild(li);

      const answerData = {
        namn: playerName,
        fr√•ga: currentQuestion,
        svar: answer,
        tid: Date.now()
      };
      db.ref("svar").push(answerData);

      document.getElementById("answerInput").value = "";
      document.getElementById("answerSection").classList.add("hidden");

      questionCount++;
      if (questionCount >= maxQuestions) {
        endGame();
      } else {
        document.getElementById("nextSection").classList.remove("hidden");
        document.getElementById("greeting").textContent = `Fr√•ga ${questionCount + 1} av ${maxQuestions}`;
      }
    }

    function resetGame() {
      document.body.style.background = "linear-gradient(to bottom, #a3dfff, #d4f1ff)";
      document.body.style.color = "#111";
      document.getElementById("question").classList.add("hidden");
      document.getElementById("nextSection").classList.add("hidden");
      document.getElementById("questionSection").classList.remove("hidden");
    }

    function endGame() {
      document.getElementById("question").textContent = `üéâ Bra jobbat, ${playerName}! Du har svarat p√• ${maxQuestions} fr√•gor.`;
      document.getElementById("answerSection").classList.add("hidden");
      document.getElementById("questionSection").classList.add("hidden");
      document.getElementById("nextSection").classList.add("hidden");
    }
  </script>

  <script>
    // PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(reg => console.log('Service Worker registrerad:', reg))
          .catch(err => console.log('Service Worker-fel:', err));
      });

      let deferredPrompt;
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;

        const installBtn = document.createElement('button');
        installBtn.textContent = 'Installera appen';
        installBtn.className = 'button';
        installBtn.style.position = 'fixed';
        installBtn.style.bottom = '20px';
        installBtn.style.left = '50%';
        installBtn.style.transform = 'translateX(-50%)';
        document.body.appendChild(installBtn);

        installBtn.addEventListener('click', () => {
          installBtn.remove();
          deferredPrompt.prompt();
          deferredPrompt.userChoice.then(choiceResult => {
            console.log('Anv√§ndarens val:', choiceResult.outcome);
          });
        });
      });
    }
  </script>
</body>
</html>
